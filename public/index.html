<!DOCTYPE html>
<html>
<head>
    <link href="/css/style.css" rel="stylesheet" />
    <link
        rel="stylesheet"
        href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
    />
</head>
<body style="background-color: lightgrey">
    <div class="container-fluid">
        <nav class="navbar navbar-expand-lg bg-body-tertiary">
            <div class="container-fluid justify-content-end">
                <div class="collapse navbar-collapse">
                    <div class="navbar-nav">
                        <a href="https://fidoalliance.org/passkeys/" class="nav-link"
                           >FIDO - Passkeys</a
                        >
                        <div class="vr"></div>
                        <a
                            href="https://passkeys.dev/device-support/#matrix"
                            class="nav-link"
                            >Passkey.dev - Support</a
                        >
                        <div class="vr"></div>
                        <a
                            class="nav-link"
                            target="_top"
                            href="https://glitch.com/edit/#!/remix/pastoral-eastern-iodine"
                        >
                            <img
                                src="https://cdn.glitch.com/605e2a51-d45f-4d87-a285-9410ad350515%2FLogo_Color.svg?v=1618199565140"
                                alt=""
                            />
                            Remix on Glitch
                        </a>
                    </div>
                </div>
            </div>
        </nav>
        <div class="container-fluid py-4" style="background-color: lightgrey">
            <div class="row justify-content-center">
                <div class="col-md-8 col-lg-6" id="configCard">
                    <div class="card shadow mb-3">
                        <div class="card-header">PingOne Service Configuration</div>
                        <div class="card-body">
                            <form id="passkeyEnvDetails">
                                <p>
                                    <a class="btn btn-outline-secondary w-100 mb-3" data-bs-toggle="collapse" href="#environmentDetails" role="button" aria-expanded="false" aria-controls="environmentDetails">
                                        Worker Details
                                    </a>
                                </p>
                                <div class="collapse" id="environmentDetails">
                                    <div class="mb-3">
                                        <div class="row g-2 align-items-center">
                                          <div class="form-text">Specify your PingOne Environment ID and Region.</div>
                                            <div class="form-floating col-md-8">
                                                <input
                                                    type="text"
                                                    class="form-control"
                                                    id="floatInputEnv"
                                                    placeholder=""
                                                    required
                                                />
                                                <label for="floatInputEnv" class="form-label">PingOne Environment ID</label>
                                            </div>
                                            <div class="col-md-4">
                                                <select
                                                    class="form-select"
                                                    id="regionSelect"
                                                    required
                                                >
                                                    <option value="com">US</option>
                                                    <option value="ca">CA</option>
                                                    <option value="eu">EU</option>
                                                    <option value="com.au">AU</option>
                                                    <option value="asia">AP</option>
                                                </select>
                                            </div>
                                        </div>
                                        
                                    </div>
                                  <div class="form-text">Enter your Worker Details.</div>
                                    <div class="form-floating mb-3">
                                        <input
                                            type="text"
                                            class="form-control"
                                            id="floatInputWorkerId"
                                            placeholder=""
                                            required
                                        />
                                        <label for="floatInputWorkerId">PingOne Worker ID (<code>Client_Secret_Basic</code>)</label>
                                    </div>
                                    <div class="form-floating mb-3">
                                        <input
                                            type="password"
                                            class="form-control"
                                            id="floatInputWorkerSecret"
                                            placeholder=""
                                            required
                                        />
                                        <label for="floatInputWorkerSecret">PingOne Worker Secret</label>
                                    </div>
                                </div>
                              <hr>
                                <div class="form-floating mb-3">
                                    <input
                                        type="text"
                                        class="form-control"
                                        id="floatInputUserID"
                                        placeholder=""
                                        required
                                    />
                                    <label for="floatInputUserName">PingOne User ID</label>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="row">
            <div class="col d-flex">
                <div class="card flex-fill">
                    <div class="card-body">
                        <h4 class="card-title">Register Passkey</h4>
                        <div class="card-text">
                            Registering a Passkey with P1 MFA involves 2 calls to the
                            service:
                            <ul class="mt-3">
                                <li>
                                    Create the device for the User [<a
                                        href="https://apidocs.pingidentity.com/pingone/platform/v1/api/#post-create-mfa-user-device-fido2"
                                        >API</a
                                    >]

                                        <li>
                                            P1 MFA returns an object used to call the browsers
                                            WebAuthN API
                                        </li>
                                    <ul>
                                        <li>
                                            The <code>publicKeyCredentialCreationOptions</code> is
                                            sent to the <code>Register()</code> WebAuthN function
                                        </li>
                                    </ul>
                                </li>
                                <li>
                                    Returned <code>attestation</code> is passed back to P1 MFA -->
                                    Activate Device [<a
                                        href="https://apidocs.pingidentity.com/pingone/platform/v1/api/#post-check-assertion-fido-device"
                                        >API</a
                                    >]
                                </li>
                            </ul>
                            <p>
                                <strong>Note:</strong> Both of these calls require a P1 Worker
                                token and so are performed on a server-side process.
                            </p>
                        </div>
                    </div>
                    <div class="card-footer">
                        <button class="btn btn-success" onclick="registerOnClick();">
                            Register
                        </button>
                    </div>
                </div>
            </div>
            <div class="col d-flex">
                <div class="card flex-fill">
                    <div class="card-body">
                        <h4 class="card-title">Authenticate Passkey</h4>
                        <div class="card-text">
                            Authenticating with a Passkey involves a set of calls with P1
                            MFA:
                            <ul class="mt-3">
                                <li>
                                    Create Device Authentication for the User's Device (Default)
                                    [<a
                                        href="https://apidocs.pingidentity.com/pingone/platform/v1/api/#post-initialize-device-authentication"
                                        >API</a
                                    >]
                                    <ul>
                                        <li>
                                            Specified UserID - Call made with <code>{user: {id: "{{userId}}"}}</code>
                                        </li>
                                        <li>
                                            Usernameless - Call made with <code>{rp: {id: "pingone-passkey-demo.glitch.me"}}</code>
                                        </li>
                                    </ul>
                                        <li>
                                            P1 MFA returns an object used to call the browsers WebAuthN API
                                        </li>
                                    <ul>
                                        <li>
                                            The <code>publicKeyCredentialRequestOptions</code> is
                                            sent to the <code>Authenticate()</code> WebAuthN function
                                        </li>
                                    </ul>
                                </li>
                                <li>
                                    Returned <code>assertion</code> is passed to P1 MFA --> Check FIDO Assertion for
                                    validation [<a
                                        href="https://apidocs.pingidentity.com/pingone/platform/v1/api/#post-check-assertion-fido-device"
                                        >API</a
                                    >]
                                </li>
                            </ul>
                            <p>
                                <strong>Note:</strong> Both of these calls require a P1 Worker
                                token and so are performed on a server-side process.
                            </p>
                        </div>
                    </div>
                    <div class="card-footer">
                        <button class="btn btn-primary" onclick="authenticateOnClick()">
                            Authenticate
                        </button>
                    </div>
                </div>
            </div>
        </div>
        <div class="row p-3">
            <div class="col">
                <div class="card" id="resultCard">
                    <div class="card-body">
                        <h5 class="card-title" id="firstCallTitle"></h5>
                        <div
                            class="border overflow-auto text-start p-2"
                            id="firstCall"
                            style="height: 200px"
                        ></div>
                    </div>
                    <div class="card-body">
                        <h5 class="card-title" id="browserResultTitle"></h5>
                        <div
                            class="border overflow-auto text-start text-wrap p-2"
                            id="browserResult"
                            style="height: 100px"
                        ></div>
                    </div>
                    <div class="card-body">
                        <h5 class="card-title" id="secondCallTitle"></h5>
                        <div
                            class="border overflow-auto text-start text-wrap p-2"
                            id="secondCall"
                            style="height: 200px"
                        ></div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <footer class="footer"></footer>
</body>
<script src="scripts/webauthn.js"></script>
<script src="scripts/passkey.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</html>