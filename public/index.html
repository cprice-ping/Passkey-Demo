<!DOCTYPE html>
<html>
  <head>
    <link href="/css/style.css" rel="stylesheet" />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
    />
  </head>
  <body style="background-color: lightgrey">
    <div class="container-fluid">
      <div class="row p-3 justify-content-center">
        <div class="col-4">
          <div class="card">
            <div class="card-body">
              <input
                type="text"
                class="form-control"
                id="userId"
                placeholder="PingOne User ID"
              />
            </div>
          </div>
        </div>
      </div>
      <div class="row">
        <div class="col d-flex">
          <div class="card">
            <div class="card-body">
              <h4 class="card-title">Register Passkey</h4>
              <div class="card-text">
                Registering a Passkey with P1 MFA involves 2 calls to the
                service:
                <ul class="mt-3">
                  <li>
                    Create the device for the User [<a
                      href="https://apidocs.pingidentity.com/pingone/platform/v1/api/#post-create-mfa-user-device-fido2"
                      >API</a
                    >]
                  </li>
                  <ul>
                    <li>
                      P1 MFA returns an object used to call the browsers
                      WebAuthN API
                    </li>
                    <li>
                      The <code>publicKeyCredentialCreationOptions</code> is
                      sent to the <code>Register()</code> WebAuthN function
                    </li>
                  </ul>
                  <li>
                    The result of this function is passed back to the P1 MFA
                    ActivateDevice [<a
                      href="https://apidocs.pingidentity.com/pingone/platform/v1/api/#post-check-assertion-fido-device"
                      >API</a
                    >]
                  </li>
                </ul>
                <p>
                  <strong>Note:</strong> Both of these calls require a P1 Worker
                  token and so are performed on a server-side process.
                </p>
              </div>
            </div>
            <div class="card-footer">
              <button class="btn btn-success" onclick="registerOnClick();">
                Register
              </button>
            </div>
          </div>
        </div>
        <div class="col d-flex">
          <div class="card">
            <div class="card-body">
              <h4 class="card-title">Authenticate Passkey</h4>
              <div class="card-text">
                Authenticating with a Passkey involves a set of calls with P1
                MFA:
                <ul class="mt-3">
                  <li>
                    Create Device Authentication for the User Device (Default)
                    [<a
                      href="https://apidocs.pingidentity.com/pingone/platform/v1/api/#post-initialize-device-authentication"
                      >API</a
                    >]
                  </li>
                  <ul>
                    <li>
                      P1 MFA will return the
                      <code>publicKeyCredentialCreationOptions</code> object
                    </li>
                    <li>
                      This gets passed into the
                      <code>Authenticate()</code> WebAuthN function in the
                      browser
                    </li>
                  </ul>
                  <li>
                    Returned <code>assertion</code> is passed to P1 MFA for
                    validation [<a
                      href="https://apidocs.pingidentity.com/pingone/platform/v1/api/#post-check-assertion-fido-device"
                      >API</a
                    >]
                  </li>
                </ul>
                <p>
                  <strong>Note:</strong> Both of these calls require a P1 Worker
                  token and so are performed on a server-side process.
                </p>
              </div>
            </div>
            <div class="card-footer">
              <button class="btn btn-primary" onclick="authenticateOnClick()">
                Authenticate
              </button>
            </div>
          </div>
        </div>
      </div>
      <div class="row p-3">
        <div class="col">
          <div class="card d-none" id="registerCard">
            <div class="card-body">
              <h5 class="card-title">P1 MFA - Create Device</h5>
              <div
                class="border overflow-auto text-start"
                id="createDevice"
                style="height: 200px"
              ></div>
            </div>
            <div class="card-body">
              <h5 class="card-title">Browser - Register() result</h5>
              <div
                class="border overflow-auto text-start text-wrap"
                id="registerResult"
                style="height: 100px"
              ></div>
            </div>
            <div class="card-body">
              <h5 class="card-title">P1 MFA - Activate Device</h5>
              <div
                class="border overflow-auto text-start"
                id="activateDevice"
                style="height: 200px"
              ></div>
            </div>
          </div>
        </div>
        <div class="card d-none" id="authenticateCard">
          <div class="card-body">
            <h5 class="card-title">P1 MFA - Create Device Authentication <span id="startStatus"></span></h5>
            <div
              class="border overflow-auto text-start"
              id="createDeviceAuthentication"
              style="height: 200px"
            ></div>
          </div>
          <div class="card-body">
            <h5 class="card-title">Browser - Authenticate() result</h5>
            <div
              class="border overflow-auto text-start text-break"
              id="authenticateResult"
            ></div>
          </div>
          <div class="card-body">
            <h5 class="card-title">P1 MFA - Return Assertion <span id="endStatus"></span></h5>
            <div
              class="border overflow-auto text-start"
              id="validateAssertion"
              style="height: 200px"
            ></div>
          </div>
        </div>
      </div>
    </div>
  </body>
  <script src="scripts/webauthn.js"></script>
  <script src="scripts/demo.js"></script>
</html>
